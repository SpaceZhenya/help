<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Live Translator GitHub Pages üåç</title>
<style>
body { font-family: Arial; background: #f2f2f2; padding: 20px; }
h1 { color: #2c3e50; }
select, button { padding: 10px; margin: 5px; }
#translations { margin-top: 20px; background: #fff; padding: 15px; border-radius: 10px; max-height: 400px; overflow-y: auto; }
.entry { margin-bottom: 10px; }
.inputText { color: #34495e; }
.translatedText { color: #27ae60; font-weight: bold; }
.copy-btn { margin-left: 10px; padding: 2px 5px; font-size: 12px; }
</style>
</head>
<body>
<h1>Live Translator üåç</h1>

<label>–Ø–∑—ã–∫ 1:</label>
<select id="lang1">
  <option value="ru">–†—É—Å—Å–∫–∏–π</option>
  <option value="en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
  <option value="fr">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
  <option value="es">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
</select>

<label>–Ø–∑—ã–∫ 2:</label>
<select id="lang2">
  <option value="en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
  <option value="ru">–†—É—Å—Å–∫–∏–π</option>
  <option value="fr">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
  <option value="es">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
</select>

<button id="start">–ù–∞—á–∞—Ç—å</button>
<button id="stop">–°—Ç–æ–ø</button>

<div id="translations"></div>

<script>
if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
  alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç SpeechRecognition. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome –∏–ª–∏ Edge.");
}

const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.continuous = true;
recognition.interimResults = false;

const outputDiv = document.getElementById('translations');
const lang1Select = document.getElementById('lang1');
const lang2Select = document.getElementById('lang2');

let activeLang = lang1Select.value;

start.onclick = () => {
  recognition.lang = activeLang + '-' + activeLang.toUpperCase();
  recognition.start();
};

stop.onclick = () => recognition.stop();

async function translateText(text, source, target){
  const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${source}|${target}`;
  const response = await fetch(url);
  const data = await response.json();
  return data.responseData.translatedText;
}

recognition.onresult = async (event) => {
  const text = event.results[event.results.length - 1][0].transcript.trim();
  if(!text) return;

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫ –ø–æ —Å–µ–ª–µ–∫—Ç–æ—Ä—É
  const detectedLang = activeLang;
  const targetLang = (detectedLang === lang1Select.value) ? lang2Select.value : lang1Select.value;

  const translation = await translateText(text, detectedLang, targetLang);

  // –í—ã–≤–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω
  const entry = document.createElement('div');
  entry.classList.add('entry');
  entry.innerHTML = `<div class="inputText">${text} (${detectedLang})</div>
                     <div class="translatedText">${translation} (${targetLang})
                     <button class="copy-btn" onclick="navigator.clipboard.writeText('${translation}')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button></div>`;
  outputDiv.prepend(entry);

  // –û–∑–≤—É—á–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞
  const utter = new SpeechSynthesisUtterance(translation);
  utter.lang = targetLang + '-' + targetLang.toUpperCase();
  speechSynthesis.speak(utter);
};
</script>
</body>
</html>
